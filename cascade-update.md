---
description: 级联更新（当某章设计变更后，自动调整受影响的后续章节）
argument-hint: <卷号> <起始章号> [结束章号]
---

# 级联更新任务：$ARGUMENTS

**当你用 design-scene 重新设计了某章，导致与后续章节承接断裂时，使用此命令自动修复。**

> **痛点解决**：
> - 第1章改了，第2章的开头承接就不对了
> - 改一章要手动改后面十几章，太累
> - 担心漏改，导致前后矛盾

---

## 第一步：读取上下文

1. **读取卷大纲**：`卷X-卷名/卷X大纲.md`
2. **读取变更章节**：定位第X章的当前设计
3. **读取后续章节**：从X+1章开始，直到卷末或指定结束章
4. **读取全卷约束**：提取节奏锚点、情绪曲线、伏笔计划

---

## 第二步：变更点识别

对比变更章节的 **新设计** 与 **原设计**，提取关键变更：

```markdown
## 变更点分析

### 第X章变更摘要

| 维度 | 原设计 | 新设计 | 变更程度 |
|------|--------|--------|----------|
| 核心事件 | [原] | [新] | 重大/中等/轻微 |
| 情绪走向 | [原] | [新] | 重大/中等/轻微 |
| 时间线 | [原] | [新] | 重大/中等/轻微 |
| 人物状态 | [原] | [新] | 重大/中等/轻微 |
| 伏笔/悬念 | [原] | [新] | 重大/中等/轻微 |
| 章末钩子 | [原] | [新] | 重大/中等/轻微 |

### 关键变更点
1. [变更点1]：[具体描述]
2. [变更点2]：[具体描述]
...
```

---

## 第三步：影响范围评估

分析变更对后续章节的影响：

```markdown
## 影响范围评估

### 直接影响（必须调整）

| 章节 | 受影响点 | 影响程度 | 调整难度 |
|------|----------|----------|----------|
| 第X+1章 | [承接点断裂] | ★★★★★ | 需重写开头 |
| 第X+2章 | [时间线不匹配] | ★★★☆☆ | 微调即可 |
| ... | ... | ... | ... |

### 间接影响（建议调整）

| 章节 | 受影响点 | 影响程度 | 调整建议 |
|------|----------|----------|----------|
| 第Y章 | [情绪铺垫缺失] | ★★☆☆☆ | 可选调整 |
| ... | ... | ... | ... |

### 无影响（确认安全）

从第Z章开始，变更影响已消散，后续章节无需调整。

### 影响半径
- **强影响区**：第X+1章 ~ 第X+N章（必须调整）
- **弱影响区**：第X+N+1章 ~ 第X+M章（建议调整）
- **安全区**：第X+M+1章之后（无需调整）
```

---

## 第四步：生成调整方案

对每个受影响章节，生成具体的调整方案：

```markdown
## 级联调整方案

### 第X+1章调整

**原开头**：
> [原文摘录]

**问题**：
- [承接断裂点1]
- [承接断裂点2]

**建议调整**：
> [新的开头建议]

**需要修改的其他部分**：
1. [具体修改点]：[原] → [新]
2. [具体修改点]：[原] → [新]

---

### 第X+2章调整

**原内容问题**：
- [问题描述]

**建议调整**：
- [调整建议]

---

### 第X+3章调整
...
```

---

## 第五步：伏笔/悬念同步检查

确保变更不会破坏全卷的伏笔系统：

```markdown
## 伏笔同步检查

### 受影响的伏笔

| 伏笔 | 原埋设章节 | 变更后状态 | 处理建议 |
|------|------------|------------|----------|
| [伏笔A] | 第X章 | 已删除/已修改 | 移至第Y章/重新埋设 |
| [伏笔B] | 第X章 | 保留 | 无需处理 |

### 受影响的悬念钩子

| 悬念 | 原章节 | 原回收章节 | 变更后处理 |
|------|--------|------------|------------|
| [悬念A] | 第X章末 | 第X+2章 | 需要调整回收方式 |

### 伏笔修复建议
1. [建议1]
2. [建议2]
```

---

## 第六步：情绪曲线重校

确保变更后全卷情绪曲线依然合理：

```markdown
## 情绪曲线重校

### 原曲线（第X章~第X+N章）
```
章节: X   X+1  X+2  X+3  X+4  X+5
情绪: ▃   ▅    ▆    ▄    ▇    █
```

### 变更后曲线
```
章节: X   X+1  X+2  X+3  X+4  X+5
情绪: ▅   ▃    ▅    ▆    ▇    █
      ↑   ↑
     变更 需调整
```

### 曲线问题
- [问题1]：连续两章情绪下降，缺乏起伏
- [问题2]：高潮来得太突然，缺乏铺垫

### 曲线修复建议
- 第X+1章：增加一个小冲突，提升情绪
- 第X+2章：保持原设计
```

---

## 第七步：用户确认

```markdown
## 级联更新确认

### 变更摘要
- 触发章节：第X章
- 影响范围：第X+1章 ~ 第X+N章（共N章）
- 调整程度：[重大调整/中等调整/轻微调整]

### 将执行以下操作
1. 更新第X+1章：[摘要]
2. 更新第X+2章：[摘要]
3. ...
4. 更新伏笔清单：[摘要]

### 确认选项
- **[A] 全部接受**：自动执行所有调整
- **[B] 逐章确认**：逐个章节确认后再执行
- **[C] 仅查看**：只输出建议，不执行修改
- **[D] 取消**：放弃本次级联更新
```

---

## 第八步：执行更新

根据用户选择执行更新：

### 8.1 更新章节内容

使用 Edit 工具，直接修改 `卷X大纲.md` 中受影响章节的内容。

**更新原则**：
- 保留章节标题
- 保留场景设计标签结构（如有）
- 只修改需要调整的部分
- 保持与新设计章节的风格一致

### 8.2 更新伏笔清单

同步更新大纲末尾的伏笔清单（如有变动）。

### 8.3 生成变更日志

```markdown
## 级联更新日志

**更新时间**：[时间戳]
**触发章节**：第X章
**影响范围**：第X+1章 ~ 第X+N章

### 变更记录
| 章节 | 变更类型 | 变更内容摘要 |
|------|----------|--------------|
| 第X+1章 | 重写开头 | 从"..."改为"..." |
| 第X+2章 | 微调时间线 | "第二天"改为"当夜" |
| ... | ... | ... |

### 伏笔变更
| 伏笔 | 操作 | 说明 |
|------|------|------|
| [伏笔A] | 移动 | 从第X章移至第Y章 |

---
```

---

## 第九步：输出确认

```
===== 级联更新完成 =====

触发章节：第X章
更新范围：第X+1章 ~ 第X+N章
更新章节数：N章

已执行操作：
✓ 更新第X+1章开头承接
✓ 调整第X+2章时间线
✓ 修复伏笔A的埋设位置
✓ 重校情绪曲线

变更日志已追加到大纲末尾。

下一步：
- 检查更新后的大纲
- 如需微调，使用 /design-scene 进一步优化
- 继续使用 /auto-write 进行写作
=============================
```

---

## 使用示例

### 示例1：单章触发
```
/cascade-update 1 1
```
→ 分析第1章变更，自动调整第2章及后续受影响章节

### 示例2：指定范围
```
/cascade-update 1 5 15
```
→ 分析第5章变更，只检查第6-15章的影响

### 示例3：全卷检查
```
/cascade-update 1 1 40
```
→ 从第1章开始，检查全卷的承接关系

---

## 注意事项

1. **先设计后级联**：先用 design-scene 完成新设计，再调用本命令
2. **保留创意**：级联更新只修复承接问题，不改变你的核心创意
3. **可逆操作**：如果不满意，可以撤销（Undo）恢复
4. **逐步确认**：对于重大变更，建议选择"逐章确认"模式
5. **伏笔优先**：如果伏笔系统被破坏，会优先提示修复

---

## 与其他命令的配合

```
/design-scene 精彩场景 1 5    → 重新设计第5章
        ↓
/cascade-update 1 5           → 自动修复第6章及后续的承接
        ↓
/auto-write 1 6               → 开始写作
```
