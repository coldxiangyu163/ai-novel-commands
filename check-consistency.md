---
description: 检查章节一致性（发现问题后可自动修复）
argument-hint: <卷号> <起始章>-<结束章>
---

# 一致性检查任务：$ARGUMENTS

## 第一步：读取检查标准

1. `AGENTS.md` - 本书写作规范、人设铁律、**规划约束**
2. `小说规划.md` - 总体设定、约束表
3. `质量检查/一致性检查表.md` - 检查项目（如果存在）

## 第二步：读取设定文件

4. `人物档案/` - 所有人物档案
5. `人物档案/仇人谱.md` - 仇人清单及清算状态
6. `世界观/` - 所有世界观文件

## 第三步：读取本卷相关文件

7. `卷X-卷名/卷X大纲.md` - 本卷详细规划
8. `卷X-卷名/章节摘要.md` - 已写章节的摘要（如存在）

## 第四步：读取待检查章节

读取指定卷指定范围的所有章节文件

---

## 第五步：逐项检查

### 5.1 人物一致性

- [ ] 主角性格是否符合设定
- [ ] 主角是否违反人设铁律（圣母/心软/智商下线）
- [ ] 主角说话风格是否一致（简短、冷酷、不解释）
- [ ] 配角名字是否正确（无错字、无混淆）
- [ ] 配角性格是否一致
- [ ] 已死亡角色是否又出现

### 5.2 仇人状态一致性

- [ ] 已清算仇人是否又出现（应标注已死亡/已处理）
- [ ] 未到清算时机的仇人是否被提前处理
- [ ] 仇人的实力/地位是否符合设定

### 5.3 世界观一致性

- [ ] 时间线是否连续（D+X天是否正确）
- [ ] 灾变进程是否符合阶段表
- [ ] 设定是否前后一致
- [ ] 数值/等级是否正确

### 5.4 规划约束一致性

- [ ] **丧尸等级**：出现的丧尸等级是否符合时间表？
  - 例：D+30前不应出现E级丧尸
- [ ] **主角战力**：空间大小是否符合当前阶段？
  - 例：卷一结束不应超过20m³
- [ ] **势力规模**：团队人数是否符合约束？
  - 例：卷二不应超过15人
- [ ] **觉醒者出现**：是否有不应出现的觉醒者？
  - 例：D+180前觉醒者应极少

### 5.5 剧情一致性

- [ ] 是否符合卷大纲规划
- [ ] 大纲要求的爽点是否到位
- [ ] 大纲要求的伏笔是否埋设/回收
- [ ] 因果关系是否合理
- [ ] 物资/道具使用是否有交代

### 5.6 细节一致性

- [ ] 地点名称是否一致
- [ ] 数字是否一致（日期、数量、距离等）
- [ ] 外貌描述是否一致
- [ ] 物品状态是否连贯（用过的物品不能凭空出现）

### 5.7 章节质量检查

- [ ] 字数是否达标（4800-5200）
- [ ] 开头是否有钩子
- [ ] 结尾是否有悬念
- [ ] 是否有水文/拖沓

### 5.8 感情线一致性（如有感情线）

- [ ] **女主人设一致**：性格、外貌、说话风格是否一致
- [ ] **感情阶段正确**：当前章节的感情状态是否符合规划阶段
- [ ] **称呼一致**：主角对女主的称呼是否符合当前关系
- [ ] **互动自然**：两人的互动是否符合当前感情阶段
- [ ] **戏份合理**：女主出场是否符合本卷规划
- [ ] **感情名场面**：大纲规划的感情场景是否到位
- [ ] **冲突进展**：感情冲突是否按规划发展/解决
- [ ] **感情线比重**：是否符合规划的主线/支线比重

---

## 第六步：输出检查报告

```
╔══════════════════════════════════════════════════════════╗
║              一致性检查报告                               ║
╠══════════════════════════════════════════════════════════╣
║ 检查范围：卷X 第X章 - 第X章                               ║
║ 检查时间：YYYY-MM-DD                                     ║
╠══════════════════════════════════════════════════════════╣
║                                                          ║
║ 【人物一致性】    ✓ 通过 / ⚠ X个问题                     ║
║ 【仇人状态】      ✓ 通过 / ⚠ X个问题                     ║
║ 【世界观一致性】  ✓ 通过 / ⚠ X个问题                     ║
║ 【规划约束】      ✓ 通过 / ✗ X个违反                     ║
║ 【剧情一致性】    ✓ 通过 / ⚠ X个问题                     ║
║ 【细节一致性】    ✓ 通过 / ⚠ X个问题                     ║
║ 【章节质量】      ✓ 通过 / ⚠ X个问题                     ║
║ 【感情线】        ✓ 通过 / ⚠ X个问题（如有感情线）       ║
║                                                          ║
║ 总评分：X/10                                             ║
╚══════════════════════════════════════════════════════════╝
```

---

## 第七步：详细问题清单

```markdown
## 发现的问题（共X个）

### 🔴 严重问题（必须修复）

#### 问题1：[人设崩塌]
- 位置：第X章 第X段
- 问题：主角突然圣母心发作，救了不该救的人
- 原文：「唐健看着那个陌生人，心中一软...」
- 建议：删除或改写，主角应该冷漠拒绝

#### 问题2：[规划约束违反]
- 位置：第X章
- 问题：出现了E级丧尸，但当前时间是D+20，不符合等级时间表
- 建议：改为F级丧尸，或调整时间线

### 🟡 中等问题（建议修复）

#### 问题3：[细节矛盾]
- 位置：第X章 vs 第Y章
- 问题：主角的空间大小前后不一致（第X章说30m³，第Y章说50m³）
- 建议：统一为符合当前阶段的数值

### 🟢 轻微问题（可选修复）

#### 问题4：[字数不足]
- 位置：第X章
- 问题：字数4600，低于4800下限
- 建议：扩展某个场景
```

---

## 第八步：询问是否修复

```
发现问题：
- 🔴 严重：X个
- 🟡 中等：X个
- 🟢 轻微：X个

是否自动修复？

[1] 全部修复
[2] 仅修复严重问题
[3] 逐个确认后修复
[4] 不修复，仅保存报告

请选择 (1/2/3/4)：
```

---

## 第九步：执行修复（如用户选择修复）

### 修复流程

对于每个问题：
1. 读取对应章节文件
2. 定位问题位置
3. 按照"建议修改"进行替换
4. 保存修改后的章节
5. 记录修复日志

### 修复原则

1. **人设优先**：涉及主角人设崩塌的问题必须修复
2. **约束优先**：违反规划约束的问题必须修复
3. **最小改动**：只修改有问题的部分
4. **保持风格**：修改后的文字要符合原文风格
5. **字数平衡**：修改后字数不能大幅变化

### 修复输出

```
===== 修复完成 =====

已修复问题：X 个
- 🔴 第X章：[人设崩塌] → 已修复 ✓
- 🔴 第X章：[规划约束违反] → 已修复 ✓
- 🟡 第X章：[细节矛盾] → 已修复 ✓

跳过问题：X 个
- 🟢 第X章：[字数不足] → 用户选择跳过

修改的文件：
- 卷X-卷名/章节/第XXX章-标题.md
- ...

========================
```

---

## 第十步：更新检查记录

1. 将检查报告保存到 `质量检查/一致性检查报告-卷X-日期.md`
2. 更新 `质量检查/一致性检查表.md`：
   - 检查时间
   - 检查范围
   - 发现问题数
   - 修复问题数
3. 如有仇人状态变化，提示更新 `人物档案/仇人谱.md`

---

## 检查频率建议

| 时机 | 检查范围 |
|------|----------|
| 每写5-10章 | 最近写的章节 |
| 每卷完成后 | 整卷检查 |
| 发现问题时 | 相关章节 |

---

## 注意事项

1. **先报告后修复**：必须先输出完整报告
2. **用户确认**：修复前必须得到用户确认
3. **严重问题优先**：人设崩塌和规划约束违反是最高优先级
4. **备份意识**：重大修改前提醒用户
5. **修复透明**：清楚说明修改了什么
